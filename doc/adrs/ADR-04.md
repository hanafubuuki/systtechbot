# ADR-04: Выбор технологического стека для Frontend

**Статус:** Принято

**Дата:** 2025-10-17

**Контекст:** Sprint S2 - Инициализация Frontend проекта для веб-интерфейса systtechbot

## Контекст и проблема

Для реализации веб-интерфейса systtechbot необходимо выбрать технологический стек frontend разработки. Основные требования:

- **Дашборд статистики:** Визуализация метрик диалогов (пользователи, сообщения, графики)
- **AI-чат:** Веб-интерфейс для взаимодействия с аналитическим помощником
- **Интеграция с API:** Подключение к Mock/Real API backend
- **Современный UX:** Красивый и отзывчивый интерфейс
- **Быстрая разработка:** Инструменты для ускорения разработки MVP
- **Типобезопасность:** Минимизация ошибок на этапе разработки
- **Масштабируемость:** Возможность расширения функциональности

## Рассмотренные варианты

### Framework

1. **Next.js 15** - React фреймворк с SSR/SSG
2. **Vite + React** - легковесная сборка SPA
3. **Remix** - полнофункциональный React фреймворк
4. **Astro** - фреймворк для контент-ориентированных сайтов

### UI библиотека

1. **shadcn/ui** - копируемые компоненты на Radix UI + Tailwind
2. **Material-UI (MUI)** - готовая библиотека компонентов
3. **Ant Design** - корпоративная UI библиотека
4. **Chakra UI** - модульная библиотека компонентов

### Styling

1. **Tailwind CSS** - utility-first CSS фреймворк
2. **CSS Modules** - изолированные CSS модули
3. **Styled Components** - CSS-in-JS решение
4. **Emotion** - альтернативный CSS-in-JS

### Пакетный менеджер

1. **pnpm** - быстрый и экономный менеджер
2. **npm** - стандартный менеджер
3. **yarn** - популярная альтернатива npm
4. **bun** - новый быстрый runtime и менеджер

## Решение

**Framework:** Next.js 15 (App Router)
**Язык:** TypeScript
**UI Library:** shadcn/ui (Radix UI + Tailwind CSS)
**Styling:** Tailwind CSS
**Пакетный менеджер:** pnpm

## Обоснование

### Почему Next.js 15?

**Преимущества:**
- ✅ **React Server Components:** Оптимизация производительности, меньше JavaScript на клиенте
- ✅ **App Router:** Современная файловая маршрутизация с layouts и streaming
- ✅ **API Routes:** Встроенный backend для проксирования к основному API
- ✅ **SEO из коробки:** Server-side rendering для поисковой оптимизации
- ✅ **Streaming и Suspense:** Постепенная загрузка контента
- ✅ **Отличная документация:** Подробная документация на русском языке
- ✅ **Экосистема:** Огромное сообщество, множество готовых решений
- ✅ **Vercel интеграция:** Простое развертывание (опционально)
- ✅ **Image Optimization:** Автоматическая оптимизация изображений

**Почему не Vite + React:**
- Vite отлично подходит для SPA, но для дашборда и чата лучше иметь SSR
- Next.js предоставляет больше возможностей "из коробки"
- API routes упрощают проксирование к backend

**Почему не Remix:**
- Более молодой фреймворк, меньше готовых примеров
- Next.js имеет более зрелую экосистему
- Для MVP Next.js проще и быстрее

### Почему TypeScript?

**Преимущества:**
- ✅ **Типобезопасность:** Раннее обнаружение ошибок
- ✅ **Autocomplete:** Улучшенный DX с IntelliSense
- ✅ **Refactoring:** Безопасный рефакторинг кода
- ✅ **Документация в коде:** Типы как документация API
- ✅ **Интеграция с Next.js:** Нативная поддержка TypeScript
- ✅ **Типы для API:** Shared типы между frontend и backend

**Нет причин использовать JavaScript:** TypeScript стал стандартом индустрии для React проектов.

### Почему shadcn/ui?

**Преимущества:**
- ✅ **Не зависимость, а код:** Компоненты копируются в проект, полный контроль
- ✅ **Radix UI primitives:** Доступность (a11y) из коробки
- ✅ **Tailwind интеграция:** Стилизация через utility классы
- ✅ **Кастомизация:** Полная свобода изменения компонентов
- ✅ **Красивый дизайн:** Современные компоненты из коробки
- ✅ **AI-Ready:** Специально разработан для работы с AI инструментами
- ✅ **CLI инструмент:** Простое добавление компонентов
- ✅ **TypeScript first:** Полная типизация

**Почему не Material-UI:**
- MUI добавляет тяжелую зависимость (~2MB)
- Сложнее кастомизация стилей
- shadcn/ui дает больше контроля

**Почему не Ant Design:**
- Больше ориентирован на enterprise/admin интерфейсы
- Тяжелее, больше зависимостей
- shadcn/ui более современный

**Почему не Chakra UI:**
- CSS-in-JS подход (runtime overhead)
- Tailwind более производительный
- shadcn/ui проще для AI генерации кода

### Почему Tailwind CSS?

**Преимущества:**
- ✅ **Utility-first:** Быстрая разработка без написания CSS
- ✅ **Производительность:** Только используемые классы в продакшене
- ✅ **Консистентность:** Единая система дизайна
- ✅ **Responsive:** Простые responsive модификаторы
- ✅ **Dark mode:** Встроенная поддержка темной темы
- ✅ **JIT компилятор:** Мгновенная компиляция стилей
- ✅ **Интеграция с shadcn/ui:** Идеальное сочетание

**Почему не CSS Modules:**
- Больше boilerplate кода
- Медленнее разработка
- Tailwind более декларативный

**Почему не CSS-in-JS:**
- Runtime overhead (styled-components, emotion)
- Tailwind более производительный
- Проще для работы с SSR

### Почему pnpm?

**Преимущества:**
- ✅ **Экономия места:** Использует symlinks, одна копия пакета на диск
- ✅ **Скорость:** Быстрее npm и yarn
- ✅ **Strict mode:** Изоляция зависимостей, нет phantom dependencies
- ✅ **Monorepo support:** Отличная поддержка workspace
- ✅ **Совместимость:** Полностью совместим с npm ecosystem

**Почему не npm:**
- Медленнее установка
- Больше занимаемое место на диске
- Менее строгая изоляция зависимостей

**Почему не yarn:**
- pnpm быстрее и эффективнее
- pnpm имеет лучшую изоляцию зависимостей

**Почему не bun:**
- Слишком новый инструмент (пока не production-ready)
- Меньше совместимости с существующими инструментами
- pnpm проверен временем

## Технические решения

### 1. Структура проекта

```
frontend/
├── app/                      # Next.js App Router
│   ├── layout.tsx           # Root layout
│   ├── page.tsx             # Главная страница
│   ├── dashboard/           # Дашборд статистики
│   │   └── page.tsx
│   ├── chat/                # AI чат
│   │   └── page.tsx
│   └── api/                 # API routes (proxy к backend)
│       └── stats/
│           └── route.ts
├── components/
│   ├── ui/                  # shadcn/ui компоненты
│   ├── dashboard/           # Компоненты дашборда
│   └── chat/                # Компоненты чата
├── lib/
│   ├── api.ts              # API client
│   └── utils.ts            # Утилиты
├── types/
│   └── api.ts              # TypeScript типы API
└── public/                 # Статические файлы
```

**Принципы организации:**
- App Router вместо Pages Router (современный подход)
- Без `src/` директории (KISS)
- Компоненты разделены по фичам
- Shared типы в `types/`

### 2. Конфигурация Next.js

```typescript
// next.config.ts
const nextConfig = {
  experimental: {
    serverActions: true, // Server Actions для форм
  },
  async rewrites() {
    return [
      {
        source: '/api/backend/:path*',
        destination: 'http://localhost:8000/api/v1/:path*',
      },
    ]
  },
}
```

### 3. Интеграция shadcn/ui

```bash
# Инициализация
pnpm dlx shadcn@latest init

# Установка компонентов
pnpm dlx shadcn@latest add button card chart
```

Компоненты копируются в `components/ui/` и могут быть модифицированы.

### 4. TypeScript конфигурация

```json
{
  "compilerOptions": {
    "strict": true,
    "paths": {
      "@/*": ["./*"]
    }
  }
}
```

### 5. Инструменты разработки

- **ESLint:** Next.js ESLint конфигурация
- **Prettier:** Форматирование с поддержкой Tailwind
- **TypeScript:** Проверка типов

## Последствия

### Положительные

- ✅ **Быстрая разработка:** shadcn/ui + Tailwind ускоряют создание UI
- ✅ **Производительность:** React Server Components + Streaming
- ✅ **Типобезопасность:** TypeScript предотвращает ошибки
- ✅ **Масштабируемость:** Легко добавлять новые страницы и компоненты
- ✅ **SEO:** Server-side rendering для поисковых систем
- ✅ **Developer Experience:** Отличные инструменты и документация
- ✅ **Доступность:** Radix UI обеспечивает a11y из коробки
- ✅ **Кастомизация:** Полный контроль над компонентами
- ✅ **AI-Ready:** shadcn/ui оптимизирован для работы с AI

### Отрицательные

- ❌ **Кривая обучения:** Требуется знание Next.js App Router, RSC
- ❌ **Размер зависимостей:** Next.js + React + shadcn довольно объемны
- ❌ **Tailwind CSS:** Может показаться избыточным для простых проектов
- ❌ **Ручное управление компонентами:** shadcn/ui компоненты требуют ручного обновления
- ❌ **Версионирование:** Next.js 15 относительно новый, возможны breaking changes

### Риски и митигация

| Риск | Вероятность | Митигация |
|------|-------------|-----------|
| Breaking changes в Next.js | Средняя | Фиксация версий, тщательное тестирование перед обновлением |
| Сложность RSC для команды | Средняя | Документация, начинаем с простых паттернов |
| Производительность Tailwind | Низкая | JIT компиляция, purging неиспользуемых стилей |
| Обновление shadcn компонентов | Средняя | Документирование изменений, версионирование |
| Проблемы совместимости пакетов | Низкая | Тестирование, использование проверенных библиотек |

## Альтернативные пути

В будущем возможно:

- **Переход на Remix/TanStack Router** если потребуется более гибкая маршрутизация
- **Добавление State Management** (Zustand, Jotai) для сложного состояния
- **React Query/SWR** для управления server state
- **Vitest** для unit тестирования компонентов
- **Playwright/Cypress** для E2E тестирования
- **Storybook** для разработки компонентов в изоляции

## Критерии пересмотра решения

Решение должно быть пересмотрено если:

- Производительность Next.js не соответствует требованиям
- Появятся критические проблемы с RSC
- Команде потребуется слишком много времени на обучение
- Появятся лучшие альтернативы с существенными преимуществами
- Потребуется полностью статический сайт (Astro может быть лучше)

## Связанные решения

- ADR-01: Выбор OpenAI в качестве LLM-провайдера
- ADR-02: Выбор aiogram в качестве фреймворка для Telegram-бота
- ADR-03: Выбор PostgreSQL + Alembic + Raw SQL для персистентного хранения
- [Будущее] ADR-05: Выбор решения для State Management
- [Будущее] ADR-06: Стратегия тестирования Frontend

## Ссылки

- [Next.js Documentation](https://nextjs.org/docs)
- [shadcn/ui Documentation](https://ui.shadcn.com/)
- [Tailwind CSS Documentation](https://tailwindcss.com/docs)
- [Radix UI Documentation](https://www.radix-ui.com/)
- [pnpm Documentation](https://pnpm.io/)
- [TypeScript Documentation](https://www.typescriptlang.org/docs/)

---

**Версия:** 1.0
**Автор:** systtechbot team
**Sprint:** S2 - Инициализация Frontend проекта

