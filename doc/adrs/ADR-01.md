# ADR-01: Выбор OpenAI в качестве LLM-провайдера

**Статус:** Принято

**Дата:** 2025-10-10

**Контекст:** Разрабатываем LLM-ассистента в виде Telegram-бота для ведения диалога с пользователем в заданной роли

## Контекст и проблема

Для реализации интеллектуального Telegram-бота необходимо выбрать провайдера языковых моделей (LLM). Основные требования:
- Высокое качество генерации текста на русском языке
- Надежность и стабильность API
- Приемлемая стоимость для MVP
- Простота интеграции
- Возможность управления контекстом диалога

## Рассмотренные варианты

1. **OpenAI (GPT-4o-mini, GPT-4o)** - облачное решение от OpenAI
2. **Azure OpenAI** - корпоративное решение на базе Azure
3. **Anthropic Claude** - альтернативный облачный провайдер
4. **Локальные модели (Ollama, LM Studio)** - самохостинговые решения
5. **Yandex GPT** - российское облачное решение

## Решение

Выбран **OpenAI** с использованием модели **gpt-4o-mini** в качестве основной.

## Обоснование

### Преимущества OpenAI

- **Качество**: Лучшее качество генерации текста, особенно для русского языка
- **Надежность**: Стабильный API с высоким uptime (99.9%+)
- **Документация**: Отличная документация и большое сообщество
- **Стоимость**: Модель gpt-4o-mini предлагает оптимальное соотношение цена/качество ($0.15/$0.60 за 1M токенов)
- **Функциональность**: Поддержка streaming, function calling, vision
- **Простота интеграции**: Официальная Python-библиотека, простой API
- **Скорость разработки**: Позволяет быстро создать MVP

### Выбор модели: gpt-4o-mini

- Баланс между стоимостью и качеством
- Достаточная производительность для диалогового бота
- Возможность переключения на gpt-4o для сложных задач

## Последствия

### Положительные

- Быстрый старт разработки благодаря готовым инструментам
- Высокое качество ответов "из коробки"
- Масштабируемость без инфраструктурных затрат
- Регулярные обновления моделей от OpenAI

### Отрицательные

- **Зависимость от внешнего сервиса**: Недоступность OpenAI API критична для работы бота
- **Стоимость**: Платная модель, зависит от объема использования
- **Контроль данных**: Данные передаются в облако OpenAI
- **Географические ограничения**: Возможны проблемы с доступом в некоторых регионах
- **Rate limits**: Ограничения на количество запросов (решается через tier upgrade)

### Риски и митигация

| Риск | Вероятность | Митигация |
|------|-------------|-----------|
| Недоступность API | Средняя | Graceful degradation, уведомление пользователя |
| Превышение бюджета | Средняя | Мониторинг токенов, лимиты на пользователя |
| Блокировка сервиса | Низкая | Подготовка плана миграции на альтернативы |

## Технические детали

### Основные параметры использования

- **Основная модель**: gpt-4o-mini
- **Temperature**: 0.7 (для баланса креативности)
- **Max tokens**: 1000 (для ограничения стоимости)
- **Context window**: Последние 10 сообщений
- **Streaming**: Включен для лучшего UX

### Интеграция

- Библиотека: `openai` (официальная Python SDK)
- Аутентификация: API ключ через переменные окружения
- Обработка ошибок: Retry с exponential backoff
- Мониторинг: Логирование токенов и стоимости

## Альтернативный путь

В будущем возможен переход на:
- **LiteLLM** для абстракции и поддержки множественных провайдеров
- **Локальные модели** для снижения стоимости при высокой нагрузке
- **Azure OpenAI** для enterprise-требований

Архитектура должна предусматривать легкую смену провайдера через абстракцию (Strategy pattern).

## Критерии пересмотра решения

Решение должно быть пересмотрено если:
- Стоимость превысит $500/месяц при текущей нагрузке
- Появятся регулярные проблемы с доступностью (uptime < 99%)
- Альтернативные провайдеры покажут существенно лучшее качество
- Потребуется полный контроль над данными (on-premise решение)

## Связанные решения

- ADR-02: Выбор aiogram в качестве фреймворка для Telegram-бота
- [Будущее] ADR-03: Стратегия хранения контекста диалогов
- [Будущее] ADR-04: Архитектура системы промптов

## Ссылки

- [OpenAI API Documentation](https://platform.openai.com/docs)
- [OpenAI Pricing](https://openai.com/pricing)
- [OpenAI Python Library](https://github.com/openai/openai-python)

