# Функциональные требования к дашборду статистики

**Дата:** 2025-10-17
**Версия:** 1.0
**Спринт:** S1

---

## Обзор

Дашборд предназначен для визуализации статистики по диалогам Telegram-бота systtechbot. Дашборд отображает ключевые метрики активности пользователей и динамику использования бота.

## Источник данных

- База данных PostgreSQL с таблицами: `users`, `chats`, `messages`
- API endpoint: `GET /api/v1/stats?period={days}`
- В S1 используется Mock API с генерируемыми данными

## Метрики дашборда

### 1. Карточки метрик

Четыре карточки с ключевыми показателями в верхней части дашборда:

#### 1.1 Всего пользователей

- **Значение:** Общее количество уникальных пользователей бота
- **Источник:** `SELECT COUNT(*) FROM users WHERE deleted_at IS NULL`
- **Тренд:** Изменение в процентах относительно предыдущего периода
- **Индикатор:** Стрелка вверх/вниз + процент изменения

#### 1.2 Всего диалогов

- **Значение:** Общее количество чатов (диалогов)
- **Источник:** `SELECT COUNT(*) FROM chats WHERE deleted_at IS NULL`
- **Тренд:** Изменение в процентах относительно предыдущего периода
- **Индикатор:** Стрелка вверх/вниз + процент изменения

#### 1.3 Всего сообщений

- **Значение:** Общее количество отправленных сообщений
- **Источник:** `SELECT COUNT(*) FROM messages WHERE deleted_at IS NULL`
- **Тренд:** Изменение в процентах относительно предыдущего периода
- **Индикатор:** Стрелка вверх/вниз + процент изменения

#### 1.4 Средняя длина сообщения

- **Значение:** Средняя длина сообщения в символах (округленная)
- **Источник:** `SELECT AVG(length) FROM messages WHERE deleted_at IS NULL`
- **Тренд:** Изменение в процентах относительно предыдущего периода
- **Индикатор:** Стрелка вверх/вниз + процент изменения

### 2. График активности

Временной ряд сообщений по дням:

- **Тип:** Area chart (график с заливкой)
- **Ось X:** Даты (формат: день/месяц)
- **Ось Y:** Количество сообщений
- **Данные:** Количество сообщений за каждый день в выбранном периоде
- **Периоды:**
  - 7 дней (последняя неделя)
  - 30 дней (последний месяц)
  - 90 дней (последние 3 месяца) - по умолчанию

**Переключатель периодов:**

- Группа кнопок в правом верхнем углу графика
- Активный период подсвечивается
- При переключении обновляется запрос к API

## Формат данных

### Карточка метрики

```typescript
{
  value: number | float,        // Текущее значение
  change_percent: float,        // Изменение в процентах (-20.5, +15.2)
  trend: "up" | "down" | "stable"  // Направление тренда
}
```

### Точка временного ряда

```typescript
{
  date: "YYYY-MM-DD",          // Дата в формате ISO
  messages: number              // Количество сообщений
}
```

### Полный ответ API

```typescript
{
  total_users: MetricCard,
  total_chats: MetricCard,
  total_messages: MetricCard,
  avg_message_length: MetricCard,
  activity_chart: TimeSeriesPoint[]
}
```

## Расчет трендов

Тренд рассчитывается как изменение относительно предыдущего периода:

```
change_percent = ((current - previous) / previous) * 100

trend:
  - "up" если change_percent > 1%
  - "down" если change_percent < -1%
  - "stable" если -1% <= change_percent <= 1%
```

### График активности

- Расположение: под карточками метрик
- Высота: ~400px
- Интерактивность:
  - Tooltip при наведении на точки
  - Переключатель периодов
- Оформление:
  - Градиентная заливка под линией
  - Сглаженные линии (curved lines)
  - Сетка для удобства чтения значений

## Состояния загрузки

1. **Loading:** Отображение skeleton loader для карточек и графика
2. **Success:** Отображение данных
3. **Error:** Сообщение об ошибке с возможностью повторного запроса

## Обновление данных

- Данные загружаются при монтировании компонента
- При переключении периода - новый запрос к API
- Нет автоматического обновления (polling) в MVP

## Ограничения MVP

- Только базовые метрики (без детализации)
- Без фильтрации по пользователям
- Без экспорта данных
- Без drill-down в детальную статистику
- Без real-time обновлений

## Референс

UI дизайн основан на: https://ui.shadcn.com/blocks#dashboard-01

Адаптирован под специфику проекта systtechbot (метрики Telegram-бота).

## Связанные документы

- [frontend-roadmap.md](frontend-roadmap.md) - Роадмап frontend разработки
- [API контракт](../../api/models.py) - Pydantic модели (автодокументация через Swagger)
- План S1 - Детальный план реализации Mock API
