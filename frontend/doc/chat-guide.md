# Daily Reporter - Руководство пользователя

**Версия:** 1.1
**Дата:** 2025-10-17
**Спринт:** S3

---

## Обзор

Daily Reporter — это AI-ассистент для помощи сотрудникам systtech с ежедневными задачами и отчетностью. Чат позволяет задавать любые вопросы на естественном языке, а для сотрудников systtech предоставляет возможность анализировать свою работу через доступ к базе данных.

## Основные возможности

### 1. Универсальный помощник

Вы можете задавать любые вопросы:

- Общие вопросы на любую тему
- Помощь с формулировками и текстами
- Советы и рекомендации
- Объяснения и обучение

### 2. Специализация для сотрудников systtech

Для анализа вашей работы можете спрашивать:

- "Над какими задачами я работал сегодня?"
- "Сколько времени я потратил на задачу X?"
- "Покажи мою активность за последнюю неделю"
- "Какие сообщения я отправлял вчера?"
- "Найди все мои диалоги по теме Y"

### 3. Автоматическая генерация SQL

Для запросов о вашей работе чат автоматически генерирует SQL запросы:

```sql
SELECT COUNT(*) FROM users WHERE deleted_at IS NULL
```

SQL запросы формируются с учетом:
- Безопасности (только SELECT запросы)
- Фильтрации удаленных записей (deleted_at IS NULL)
- Оптимизации производительности

### 4. Понятные ответы

После выполнения SQL запроса, AI формирует понятный ответ на русском языке с интерпретацией данных.

### 5. Контекстная история

Чат сохраняет историю диалога, что позволяет:
- Уточнять вопросы
- Ссылаться на предыдущие ответы
- Вести последовательный диалог

## Примеры использования

### Общие вопросы

**Вопрос:** Как правильно написать email клиенту?
**Ответ:** [Помощь с формулировкой]

**Вопрос:** Объясни, что такое REST API
**Ответ:** [Понятное объяснение концепции]

### Для сотрудников systtech

**Вопрос:** Над какими задачами я работал сегодня?
**Ответ:** [Анализ сообщений за день с выявлением тем]

**Вопрос:** Сколько времени я потратил на обсуждение проекта X?
**Ответ:** [Подсчет активности по ключевым словам]

**Вопрос:** Покажи мою активность за последнюю неделю
**Ответ:** [Данные о количестве сообщений по дням]

**Вопрос:** Какие сообщения я отправлял вчера?
**Ответ:** [Список сообщений с временем]

## Структура базы данных

Чат работает со следующими таблицами:

### users (Пользователи)
- `id` — внутренний ID
- `telegram_user_id` — ID в Telegram
- `first_name` — имя пользователя
- `created_at` — дата регистрации
- `deleted_at` — дата удаления (NULL если активен)

### chats (Диалоги)
- `id` — внутренний ID
- `telegram_chat_id` — ID чата в Telegram
- `created_at` — дата создания
- `deleted_at` — дата удаления (NULL если активен)

### messages (Сообщения)
- `id` — внутренний ID
- `user_id` — ID пользователя
- `chat_id` — ID чата
- `role` — роль ('system', 'user', 'assistant')
- `content` — текст сообщения
- `length` — длина сообщения в символах
- `created_at` — дата создания
- `deleted_at` — дата удаления (NULL если активно)

## Ограничения

### Безопасность
- ✅ Разрешены только SELECT запросы
- ❌ Запрещены INSERT, UPDATE, DELETE, DROP
- ✅ Автоматическая фильтрация удаленных записей

### Производительность
- Ограничение на количество возвращаемых строк: 50
- Timeout запроса: 30 секунд
- Рекомендуется использовать фильтры для больших выборок

### Функциональность
- Нет real-time обновлений
- Нет экспорта данных
- Нет визуализации внутри чата (используйте Dashboard)

## Управление историей

### Очистка истории

Нажмите кнопку "Очистить историю" в правом верхнем углу для удаления всех сообщений текущего диалога.

**Внимание:** Это действие необратимо!

### Сохранение истории

История автоматически сохраняется в базе данных после каждого сообщения. При закрытии и повторном открытии чата история восстанавливается.

## Советы по использованию

### 1. Формулируйте вопросы естественно

Daily Reporter понимает естественный язык, задавайте вопросы как обычно:

❌ Не нужно специальные команды: "/show users"
✅ Просто спросите: "Покажи мою активность за неделю"

### 2. Используйте контекст

```
Вы: Сколько пользователей зарегистрировалось в январе?
AI: В январе зарегистрировалось 145 пользователей.

Вы: А сколько из них отправили хотя бы одно сообщение?
AI: Из 145 пользователей, 98 отправили хотя бы одно сообщение.
```

### 3. Уточняйте детали

Если ответ недостаточно детален, попросите уточнить:
- "Покажи детальную разбивку"
- "Покажи по дням"
- "Добавь группировку по часам"

### 4. Проверяйте SQL (для разработчиков)

В консоли браузера можно увидеть выполненный SQL запрос для отладки:

```javascript
console.log('SQL executed:', response.sql_executed)
```

## Устранение проблем

### Ошибка: "Failed to send message"

**Причина:** Проблема с подключением к backend
**Решение:** Проверьте, что API запущен на `http://localhost:8000`

### Ошибка: "Запрос содержит запрещенное ключевое слово"

**Причина:** AI попытался сгенерировать небезопасный SQL
**Решение:** Переформулируйте вопрос, избегая слов вроде "удалить", "обновить"

### Медленные ответы

**Причина:** Сложный SQL запрос или большой объем данных
**Решение:**
- Добавьте ограничения по времени ("за последний месяц")
- Используйте ограничения на количество ("топ-10", "первые 5")

## API Endpoints

### POST /api/v1/chat
Отправить сообщение в чат

**Request:**
```json
{
  "user_id": 1,
  "message": "Сколько всего пользователей?",
  "history": []
}
```

**Response:**
```json
{
  "response": "В системе 1,234 пользователя.",
  "sql_executed": "SELECT COUNT(*) FROM users WHERE deleted_at IS NULL"
}
```

### POST /api/v1/chat/clear
Очистить историю чата

**Request:**
```json
{
  "user_id": 1
}
```

**Response:**
```json
{
  "status": "success",
  "message": "История чата успешно очищена"
}
```

## Дальнейшее развитие

Планируемые улучшения:
- Сохранение избранных запросов
- Экспорт результатов в CSV/Excel
- Визуализация данных внутри чата
- Рекомендации похожих запросов
- Мультиязычность

## Связанные документы

- [frontend-roadmap.md](frontend-roadmap.md) — Роадмап frontend разработки
- [dashboard-requirements.md](dashboard-requirements.md) — Требования к дашборду
- План S3 — Детальный план реализации

---

**Обратная связь:** Если у вас есть вопросы или предложения по улучшению чата, создайте issue в репозитории.

